phases:
  - phase: Build
    queue:
    - name: Hosted VS2017
      demands: 
      - npm
      - node.js
      - msbuild
      - visualstudio
      - vstest
    steps:
    - task: Npm@1
      inputs:
        workingDir: 'src/AgeBaseTemplate.UI'
        verbose: false
    - task: Gulp@0
      inputs:
        gulpFile: 'src/AgeBaseTemplate.UI/gulpfile.js'
    - task: NuGetCommand@2
      inputs:
        restoreSolution: '$(Parameters.solution)'
    - task: VSBuild@1
      inputs:
        solution: '$(Parameters.solution)'
        msbuildArgs: '/p:DeployOnBuild=true /p:WebPublishMethod=Package /p:PackageAsSingleFile=true /p:SkipInvalidConfigurations=true /p:PackageLocation="$(build.artifactstagingdirectory)\\"'
        platform: '$(BuildPlatform)'
        configuration: '$(BuildConfiguration)'
    - task: VSTest@2
      inputs:
        testAssemblyVer2: '**\$(BuildConfiguration)\*test*.dll'
        platform: '$(BuildPlatform)'
        configuration: '$(BuildConfiguration)'
    - task: NuGetCommand@2
      inputs:
        command: pack
        packagesToPack: 'src/AgeBaseTemplate/AgeBaseTemplate.nuspec'
        versioningScheme: byBuildNumber
    - task: NuGetCommand@2
      inputs:
        command: push
        publishVstsFeed: '6f1e4b39-3b52-432d-8212-23059fcff0fb'
