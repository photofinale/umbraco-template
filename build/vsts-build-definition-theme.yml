resources:
  - repo: self
    clean: true

queue:
  - name: Hosted VS2017
    demands: 
    - npm
    - node.js
  
steps:
  - task: Npm@1
    inputs:
      workingDir: 'src/$(agebasetemplate.ui)'
      verbose: false
  
  - task: Gulp@0
    inputs:
      gulpFile: 'src/$(agebasetemplate.ui)/gulpfile.js'
  
  - task: NuGetCommand@2
    inputs:
      restoreSolution: 'src/packages.config'
      vstsFeed: '$(Parameters.feedRestore)'
      restoreDirectory: packages
  
  - task: CmdLine@1
    inputs:
      filename: del
      arguments: '/S *.nupkg'
      workingFolder: 'src/packages/AgeBaseTemplate.$(agebasetemplate.version)/'
  
  - task: CmdLine@1
    inputs:
      filename: del
      arguments: '/S *.Debug.config'
      workingFolder: 'src/packages/AgeBaseTemplate.$(agebasetemplate.version)/'
  
  - task: CmdLine@1
    inputs:
      filename: del
      arguments: '/S *.Release.config'
      workingFolder: 'src/packages/AgeBaseTemplate.$(agebasetemplate.version)/'
  
  - task: CopyFiles@2
    inputs:
      SourceFolder: 'src/AgeBaseTemplate'
      TargetFolder: 'src/packages/AgeBaseTemplate.$(agebasetemplate.version)/'
      OverWrite: true
  
  - task: ArchiveFiles@2
    inputs:
      rootFolderOrFile: 'src/packages/AgeBaseTemplate.$(agebasetemplate.version)/'
      includeRootFolder: false
  
  - task: CopyPublishBuildArtifacts@1
    inputs:
      CopyRoot: '$(Build.ArtifactStagingDirectory)'
      Contents: '$(Build.BuildId).zip'
      ArtifactName: drop
      ArtifactType: Container
  