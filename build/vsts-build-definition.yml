name: AgeBaseTemplate.$(Year:yyyy).$(Month).$(DayOfMonth).$(Rev:r)
phases:
- phase: BuildTestPackAndPushNugetPackage
  queue:
    name: Hosted VS2017
    demands: 
    - npm
    - node.js
    - msbuild
    - visualstudio
    - vstest
  steps:
    - checkout: self
      clean: true
    - task: Npm@1
      inputs:
        workingDir: 'src/AgeBaseTemplate.UI'
        verbose: false
    - task: Gulp@0
      inputs:
        gulpFile: 'src/AgeBaseTemplate.UI/gulpfile.js'
    - task: NuGetCommand@2
      inputs:
        restoreSolution: 'src/AgeBaseTemplate.sln'
    - task: bleddynrichards.Assembly-Info-Task.Assembly-Info-Task.Assembly-Info-Task@1
      inputs:
        Path: src
        FileNames: AssemblyInfo.cs
        Title: 'AgeBase Template'
        Product: 'AgeBase Template'
        Description: 'AgeBase Umbraco Template is a hopefully handy template for creating Umbraco web applications. It includes your usual Umbraco features and also some nice extra features.'
        Company: 'AgeBase Ltd'
        Copyright: 'Copyright Â© $(date:yyyy) AgeBase Ltd'
        Trademark: 'Trademark of AgeBase Ltd'
        VersionNumber: '$(Year:yyyy).$(Month).$(DayOfMonth).$(Rev:r)'
        FileVersionNumber: '$(Year:yyyy).$(Month).$(DayOfMonth).$(Rev:r)'
        InformationalVersion: '$(Year:yyyy).$(Month).$(DayOfMonth).$(Rev:r)'
    - task: VSBuild@1
      inputs:
        solution: 'src/AgeBaseTemplate.sln'
        msbuildArgs: '/p:SkipInvalidConfigurations=true'
        platform: 'Any CPU'
        configuration: 'Release'
    - task: VSTest@2
      inputs:
        testAssemblyVer2: 'tests/AgeBaseTemplate.Core.Tests/bin/Release/AgeBaseTemplate.Core.Tests.dll'
        codeCoverageEnabled: true
        platform: 'Any CPU'
        configuration: 'Release'
    - task: NuGetCommand@2
      inputs:
        command: pack
        packagesToPack: 'src/AgeBaseTemplate/AgeBaseTemplate.nuspec'
        versioningScheme: byBuildNumber
    - task: NuGetCommand@2
      inputs:
        command: push
        publishVstsFeed: 'bb745c71-01f6-4ea9-b347-7c9e47d06a60'
